package actividad_evaluable;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.util.ArrayList;

public class Main {

    static ArrayList<Usuario> usuarios = new ArrayList<>();

    public static void main(String[] args) {
        JFrame ventana = crearVentana();
        JPanel panel = crearPanel();

        // Componente de color (Modo Claro/Oscuro)
        Color[] colores = establecerModo(panel);

        // Componentes del formulario
        JTextField campoNombre = crearCampoTexto(panel, "Nombre:", colores);
        JTextField campoApellidos = crearCampoTexto(panel, "Apellidos (Dos):", colores);
        JComboBox<Genero> comboGenero = crearComboBox(panel, Genero.values(), "Género:", colores);
        JTextField campoUsuario = crearCampoTexto(panel, "Usuario:", colores);
        JPasswordField campoContraseña = crearCampoContraseña(panel, "Contraseña:", colores);
        JTextField campoTelefono = crearCampoTexto(panel, "Teléfono:", colores);
        JComboBox<String> comboDestino = crearComboBox(panel, new String[] { "Elija su destino", "España", "Italia", "Francia", "Alemania", "Portugal", "Japón", "Brasil", "Canadá", "Australia", "Egipto" }, "Destino:", colores);
        JCheckBox[] vacunas = crearVacunas(panel, colores);

        // Botones de Enviar y Borrar
        JButton botonEnviar = new JButton("Enviar Datos");
        JButton botonBorrar = new JButton("Borrar Datos");
        panel.add(botonEnviar);
        panel.add(botonBorrar);

        ventana.add(panel);
        ventana.setVisible(true);

        // Acción Botón Enviar
        botonEnviar.addActionListener(e -> manejarEnvioFormulario(ventana, campoNombre, campoApellidos, campoUsuario, campoContraseña, campoTelefono, comboDestino, comboGenero, vacunas));

        // Acción Botón Borrar
        botonBorrar.addActionListener(e -> manejarBorradoFormulario(campoNombre, campoApellidos, campoUsuario, campoContraseña, campoTelefono, comboDestino, comboGenero, vacunas));
    }

    private static JFrame crearVentana() {
        JFrame ventana = new JFrame("Formulario de Registro");
        ventana.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        ventana.setSize(400, 600);
        ventana.setLocationRelativeTo(null);
        return ventana;
    }

    private static JPanel crearPanel() {
        JPanel panel = new JPanel();
        panel.setLayout(new BoxLayout(panel, BoxLayout.Y_AXIS));
        return panel;
    }

    private static Color[] establecerModo(JPanel panel) {
        String[] modos = { "Claro", "Oscuro" };
        String modo = (String) JOptionPane.showInputDialog(null, "Selecciona el modo de color:", "Modo", JOptionPane.QUESTION_MESSAGE, null, modos, modos[0]);

        Color fondo;
        Color letra;

        if ("Oscuro".equals(modo)) {
            fondo = Color.DARK_GRAY;
            letra = Color.WHITE;
        } else {
            fondo = Color.WHITE;
            letra = Color.BLUE;
        }
        panel.setBackground(fondo);
        return new Color[] { fondo, letra };
    }

    private static JTextField crearCampoTexto(JPanel panel, String textoEtiqueta, Color[] colores) {
        JTextField campoTexto = new JTextField(15);
        JLabel etiqueta = new JLabel(textoEtiqueta);
        etiqueta.setForeground(colores[1]);
        campoTexto.setBackground(colores[0]);
        campoTexto.setForeground(colores[1]);
        panel.add(etiqueta);
        panel.add(campoTexto);
        return campoTexto;
    }

    private static JComboBox<String> crearComboBox(JPanel panel, String[] opciones, String textoEtiqueta, Color[] colores) {
        JComboBox<String> comboBox = new JComboBox<>(opciones);
        JLabel etiqueta = new JLabel(textoEtiqueta);
        etiqueta.setForeground(colores[1]);
        comboBox.setBackground(colores[0]);
        comboBox.setForeground(colores[1]);
        panel.add(etiqueta);
        panel.add(comboBox);
        return comboBox;
    }

    private static JComboBox<Genero> crearComboBox(JPanel panel, Genero[] opciones, String textoEtiqueta, Color[] colores) {
        JComboBox<Genero> comboBox = new JComboBox<>(opciones);
        JLabel etiqueta = new JLabel(textoEtiqueta);
        etiqueta.setForeground(colores[1]);
        comboBox.setBackground(colores[0]);
        comboBox.setForeground(colores[1]);
        panel.add(etiqueta);
        panel.add(comboBox);
        return comboBox;
    }

    private static JPasswordField crearCampoContraseña(JPanel panel, String textoEtiqueta, Color[] colores) {
        JPasswordField campoContraseña = new JPasswordField(15);
        JLabel etiqueta = new JLabel(textoEtiqueta);
        etiqueta.setForeground(colores[1]);
        campoContraseña.setBackground(colores[0]);
        campoContraseña.setForeground(colores[1]);
        panel.add(etiqueta);
        panel.add(campoContraseña);
        return campoContraseña;
    }

    private static JCheckBox[] crearVacunas(JPanel panel, Color[] colores) {
        JCheckBox vac1 = new JCheckBox("COVID-19");
        JCheckBox vac2 = new JCheckBox("Fiebre Amarilla");
        JCheckBox vac3 = new JCheckBox("Tétanos");
        JCheckBox vac4 = new JCheckBox("Hepatitis B");

        JCheckBox[] vacunas = { vac1, vac2, vac3, vac4 };
        JLabel etiquetaVacunas = new JLabel("Vacunas (Mínimo 3):");
        etiquetaVacunas.setForeground(colores[1]);
        for (JCheckBox vac : vacunas) {
            vac.setForeground(colores[1]);
            vac.setBackground(colores[0]);
            panel.add(vac);
        }
        panel.add(etiquetaVacunas);
        return vacunas;
    }

    private static void manejarEnvioFormulario(JFrame ventana, JTextField campoNombre, JTextField campoApellidos, JTextField campoUsuario, JPasswordField campoContraseña, JTextField campoTelefono, JComboBox<String> comboDestino, JComboBox<Genero> comboGenero, JCheckBox[] vacunas) {
        String nombre = campoNombre.getText().trim();
        String apellidos = campoApellidos.getText().trim();
        String usuario = campoUsuario.getText().trim();
        String telefono = campoTelefono.getText().trim();
        String destino = (String) comboDestino.getSelectedItem();
        char[] contraseña = campoContraseña.getPassword();

        int vacunasSeleccionadas = 0;
        ArrayList<String> listaVacunas = new ArrayList<>();
        for (JCheckBox vac : vacunas) {
            if (vac.isSelected()) {
                vacunasSeleccionadas++;
                listaVacunas.add(vac.getText());
            }
        }

        if (nombre.isEmpty()) {
            JOptionPane.showMessageDialog(ventana, "El nombre no puede estar vacío.");
            return;
        }
        if (!apellidos.matches("\\w+\\s\\w+")) {
            JOptionPane.showMessageDialog(ventana, "Introduce dos apellidos separados por espacio.");
            return;
        }
        if (usuario.isEmpty()) {
            JOptionPane.showMessageDialog(ventana, "El usuario no puede estar vacío.");
            return;
        }
        if (contraseña.length == 0) {
            JOptionPane.showMessageDialog(ventana, "La contraseña no puede estar vacía.");
            return;
        }
        if (!telefono.matches("\\d+")) {
            JOptionPane.showMessageDialog(ventana, "El teléfono solo debe contener números.");
            return;
        }
        if (destino.equals("Elija su destino")) {
            JOptionPane.showMessageDialog(ventana, "Debe elegir un destino válido.");
            return;
        }
        if (vacunasSeleccionadas < 3) {
            JOptionPane.showMessageDialog(ventana, "Debe seleccionar al menos 3 vacunas.");
            return;
        }

        Usuario nuevoUsuario = new Usuario(
                nombre,
                apellidos,
                (Genero) comboGenero.getSelectedItem(),
                usuario,
                telefono,
                destino,
                listaVacunas
        );
        usuarios.add(nuevoUsuario);

        // Cerrar formulario y mostrar nueva ventana con datos
        ventana.setVisible(false);

        JFrame ventanaResumen = new JFrame("Resumen de Datos");
        JTextArea areaResumen = new JTextArea(nuevoUsuario.toString());
        areaResumen.setEditable(false);
        areaResumen.setBackground(Color.WHITE);
        ventanaResumen.add(new JScrollPane(areaResumen));
        ventanaResumen.setSize(400, 300);
        ventanaResumen.setLocationRelativeTo(null);
        ventanaResumen.setVisible(true);
        System.out.println(nuevoUsuario);
    }

    private static void manejarBorradoFormulario(JTextField campoNombre, JTextField campoApellidos, JTextField campoUsuario, JPasswordField campoContraseña, JTextField campoTelefono, JComboBox<String> comboDestino, JComboBox<Genero> comboGenero, JCheckBox[] vacunas) {
        campoNombre.setText("");
        campoApellidos.setText("");
        campoUsuario.setText("");
        campoContraseña.setText("");
        campoTelefono.setText("");
        comboDestino.setSelectedIndex(0);
        comboGenero.setSelectedIndex(0);
        for (JCheckBox vac : vacunas) {
            vac.setSelected(false);
        }
    }
}
