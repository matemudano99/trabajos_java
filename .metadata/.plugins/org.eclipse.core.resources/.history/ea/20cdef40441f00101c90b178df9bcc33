package actividad_evaluable;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.util.ArrayList;

public class Main {

	static ArrayList<Usuario> usuarios = new ArrayList<>();

	public static void main(String[] args) {
		JFrame frame = new JFrame("Formulario de Registro");
		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		frame.setSize(400, 600);
		frame.setLocationRelativeTo(null);

		JPanel panel = new JPanel();
		panel.setLayout(new BoxLayout(panel, BoxLayout.Y_AXIS));

		// MODO TEMA
		String[] modos = { "Claro", "Oscuro" };
		String modo = (String) JOptionPane.showInputDialog(null, "Selecciona el modo de color:", "Modo",
				JOptionPane.QUESTION_MESSAGE, null, modos, modos[0]);

		Color fondo;
		Color letra;

		if ("Oscuro".equals(modo)) {
			fondo = Color.DARK_GRAY;
			letra = Color.WHITE;
		} else {
			fondo = Color.WHITE;
			letra = Color.BLUE;
		}
		panel.setBackground(fondo);

		// COMPONENTES DEL FORMULARIO
		JTextField nombreField = new JTextField(15);
		JLabel nombreLabel = new JLabel("Nombre:");
		nombreLabel.setForeground(letra);
		nombreField.setBackground(fondo);
		nombreField.setForeground(letra);

		JTextField apellidosField = new JTextField(15);
		JLabel apellidosLabel = new JLabel("Apellidos (Dos):");
		apellidosLabel.setForeground(letra);
		apellidosField.setBackground(fondo);
		apellidosField.setForeground(letra);

		JComboBox<Genero> generoBox = new JComboBox<>(Genero.values());
		JLabel generoLabel = new JLabel("Género:");
		generoLabel.setForeground(letra);
		generoBox.setBackground(fondo);
		generoBox.setForeground(letra);

		JTextField userField = new JTextField(15);
		JLabel userLabel = new JLabel("Usuario:");
		userLabel.setForeground(letra);
		userField.setBackground(fondo);
		userField.setForeground(letra);

		JPasswordField passField = new JPasswordField(15);
		JLabel passLabel = new JLabel("Contraseña:");
		passLabel.setForeground(letra);
		passField.setBackground(fondo);
		passField.setForeground(letra);

		JTextField telefonoField = new JTextField(10);
		JLabel telefonoLabel = new JLabel("Teléfono:");
		telefonoLabel.setForeground(letra);
		telefonoField.setBackground(fondo);
		telefonoField.setForeground(letra);

		String[] destinos = { "Elija su destino", "España", "Italia", "Francia", "Alemania", "Portugal", "Japón",
				"Brasil", "Canadá", "Australia", "Egipto" };
		JComboBox<String> destinoBox = new JComboBox<>(destinos);
		JLabel destinoLabel = new JLabel("Destino:");
		destinoLabel.setForeground(letra);
		destinoBox.setBackground(fondo);
		destinoBox.setForeground(letra);

		JCheckBox vac1 = new JCheckBox("COVID-19");
		JCheckBox vac2 = new JCheckBox("Fiebre Amarilla");
		JCheckBox vac3 = new JCheckBox("Tétanos");
		JCheckBox vac4 = new JCheckBox("Hepatitis B");

		JCheckBox[] vacunas = { vac1, vac2, vac3, vac4 };
		JLabel vacunasLabel = new JLabel("Vacunas (Mínimo 3):");
		vacunasLabel.setForeground(letra);

		for (JCheckBox vac : vacunas) {
			vac.setForeground(letra);
			vac.setBackground(fondo);
		}

		JButton enviarBtn = new JButton("Enviar Datos");
		JButton borrarBtn = new JButton("Borrar Datos");

		// AGREGAR COMPONENTES AL PANEL
		panel.add(nombreLabel);
		panel.add(nombreField);
		panel.add(apellidosLabel);
		panel.add(apellidosField);
		panel.add(generoLabel);
		panel.add(generoBox);
		panel.add(userLabel);
		panel.add(userField);
		panel.add(passLabel);
		panel.add(passField);
		panel.add(telefonoLabel);
		panel.add(telefonoField);
		panel.add(destinoLabel);
		panel.add(destinoBox);
		panel.add(vacunasLabel);
		for (JCheckBox vac : vacunas) {
			panel.add(vac);
		}
		panel.add(enviarBtn);
		panel.add(borrarBtn);

		frame.add(panel);
		frame.setVisible(true);

		// ACCIÓN BOTÓN ENVIAR
		enviarBtn.addActionListener(e -> {
			String nombre = nombreField.getText().trim();
			String apellidos = apellidosField.getText().trim();
			String usuario = userField.getText().trim();
			String telefono = telefonoField.getText().trim();
			String destino = (String) destinoBox.getSelectedItem();
			char[] password = passField.getPassword();

			int vacunasSeleccionadas = 0;
			ArrayList<String> vacunasList = new ArrayList<>();
			for (JCheckBox vac : vacunas) {
				if (vac.isSelected()) {
					vacunasSeleccionadas++;
					vacunasList.add(vac.getText());
				}
			}

			if (nombre.isEmpty()) {
				JOptionPane.showMessageDialog(frame, "El nombre no puede estar vacío.");
				return;
			}
			if (!apellidos.matches("\\w+\\s\\w+")) {
				JOptionPane.showMessageDialog(frame, "Introduce dos apellidos separados por espacio.");
				return;
			}
			if (usuario.isEmpty()) {
				JOptionPane.showMessageDialog(frame, "El usuario no puede estar vacío.");
				return;
			}
			if (password.length == 0) {
				JOptionPane.showMessageDialog(frame, "La contraseña no puede estar vacía.");
				return;
			}
			if (!telefono.matches("\\d+")) {
				JOptionPane.showMessageDialog(frame, "El teléfono solo debe contener números.");
				return;
			}
			if (destino.equals("Elija su destino")) {
				JOptionPane.showMessageDialog(frame, "Debe elegir un destino válido.");
				return;
			}
			if (vacunasSeleccionadas < 3) {
				JOptionPane.showMessageDialog(frame, "Debe seleccionar al menos 3 vacunas.");
				return;
			}

			Usuario nuevoUsuario = new Usuario(
					nombre,
					apellidos,
					(Genero) generoBox.getSelectedItem(),
					usuario,
					telefono,
					destino,
					vacunasList.toArray(new String[0])
			);
			usuarios.add(nuevoUsuario);

			// Cerrar formulario y mostrar nueva ventana con datos
			frame.setVisible(false);

			JFrame resumenFrame = new JFrame("Resumen de Datos");
			JTextArea resumenArea = new JTextArea(nuevoUsuario.toString());
			resumenArea.setEditable(false);
			resumenArea.setBackground(Color.WHITE);
			resumenFrame.add(new JScrollPane(resumenArea));
			resumenFrame.setSize(400, 300);
			resumenFrame.setLocationRelativeTo(null);
			resumenFrame.setVisible(true);
		});

		// ACCIÓN BOTÓN BORRAR
		borrarBtn.addActionListener(e -> {
			nombreField.setText("");
			apellidosField.setText("");
			userField.setText("");
			passField.setText("");
			telefonoField.setText("");
			destinoBox.setSelectedIndex(0);
			generoBox.setSelectedIndex(0);
			for (JCheckBox vac : vacunas) {
				vac.setSelected(false);
			}
		});
	}
}
