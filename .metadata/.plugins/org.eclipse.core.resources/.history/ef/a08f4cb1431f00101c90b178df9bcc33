package actividad_evaluable;

import javax.swing.*;
import java.awt.*;
import java.util.ArrayList;

public class Main {

	static ArrayList<Usuario> usuarios = new ArrayList<>();

	public static void main(String[] args) {
		while (true) {
			crearUsuario();
		}
	}

	public static void crearUsuario() {
		JPanel panel = new JPanel();
		panel.setLayout(new BoxLayout(panel, BoxLayout.Y_AXIS));

		// MODO TEMA
		String[] modos = { "Claro", "Oscuro" };
		String modo = (String) JOptionPane.showInputDialog(null, "Selecciona el modo de color:", "Modo",
				JOptionPane.QUESTION_MESSAGE, null, modos, modos[0]);

		Color fondo;
		Color letra;

		if ("Oscuro".equals(modo)) {
			fondo = Color.DARK_GRAY;
			letra = Color.WHITE;
		} else {
			fondo = Color.WHITE;
			letra = Color.BLUE;
		}

		panel.setBackground(fondo);

		// COMPONENTES
		JTextField nombreField = new JTextField(15);
		JLabel nombreLabel = new JLabel("Nombre:");
		nombreLabel.setForeground(letra);
		panel.add(nombreLabel);
		panel.add(nombreField);

		JTextField apellidosField = new JTextField(15);
		JLabel apellidosLabel = new JLabel("Apellidos (Dos):");
		apellidosLabel.setForeground(letra);
		panel.add(apellidosLabel);
		panel.add(apellidosField);

		JComboBox<Genero> generoBox = new JComboBox<>(Genero.values());
		JLabel generoLabel = new JLabel("Género:");
		generoLabel.setForeground(letra);
		panel.add(generoLabel);
		panel.add(generoBox);

		JTextField userField = new JTextField(15);
		JLabel userLabel = new JLabel("Usuario:");
		userLabel.setForeground(letra);
		panel.add(userLabel);
		panel.add(userField);

		JPasswordField passField = new JPasswordField(15);
		JLabel passLabel = new JLabel("Contraseña:");
		passLabel.setForeground(letra);
		panel.add(passLabel);
		panel.add(passField);

		JTextField telefonoField = new JTextField(10);
		JLabel telefonoLabel = new JLabel("Teléfono:");
		telefonoLabel.setForeground(letra);
		panel.add(telefonoLabel);
		panel.add(telefonoField);

		String[] destinos = { "Elija su destino", "España", "Italia", "Francia", "Alemania", "Portugal", "Japón",
				"Brasil", "Canadá", "Australia", "Egipto" };
		JComboBox<String> destinoBox = new JComboBox<>(destinos);
		JLabel destinoLabel = new JLabel("Destino:");
		destinoLabel.setForeground(letra);
		panel.add(destinoLabel);
		panel.add(destinoBox);

		JCheckBox vac1 = new JCheckBox("COVID-19");
		JCheckBox vac2 = new JCheckBox("Fiebre Amarilla");
		JCheckBox vac3 = new JCheckBox("Tétanos");
		JCheckBox vac4 = new JCheckBox("Hepatitis B");

		JCheckBox[] vacunas = { vac1, vac2, vac3, vac4 };

		JLabel vacunasLabel = new JLabel("Vacunas (Mínimo 3):");
		vacunasLabel.setForeground(letra);
		panel.add(vacunasLabel);

		for (JCheckBox vac : vacunas) {
			vac.setForeground(letra);
			vac.setBackground(fondo);
			panel.add(vac);
		}

		// Aplicar estilo oscuro si se eligió
		if ("Oscuro".equals(modo)) {
			aplicarEstiloOscuro(nombreField, fondo, letra);
			aplicarEstiloOscuro(apellidosField, fondo, letra);
			aplicarEstiloOscuro(userField, fondo, letra);
			aplicarEstiloOscuro(passField, fondo, letra);
			aplicarEstiloOscuro(telefonoField, fondo, letra);
			aplicarEstiloOscuro(generoBox, fondo, letra);
			aplicarEstiloOscuro(destinoBox, fondo, letra);
		}

		int result = JOptionPane.showConfirmDialog(null, panel, "Formulario de Registro", JOptionPane.OK_CANCEL_OPTION);

		if (result == JOptionPane.OK_OPTION) {
			// VALIDACIONES
			String nombre = nombreField.getText().trim();
			String apellidos = apellidosField.getText().trim();
			String usuario = userField.getText().trim();
			String telefono = telefonoField.getText().trim();
			String destino = (String) destinoBox.getSelectedItem();
			char[] password = passField.getPassword();

			int vacunasSeleccionadas = 0;
			ArrayList<String> vacunasList = new ArrayList<>();
			for (JCheckBox vac : vacunas) {
				if (vac.isSelected()) {
					vacunasSeleccionadas++;
					vacunasList.add(vac.getText());
				}
			}

			if (nombre.isEmpty()) {
				JOptionPane.showMessageDialog(null, "El nombre no puede estar vacío.");
				return;
			}

			if (!apellidos.matches("\\w+\\s\\w+")) {
				JOptionPane.showMessageDialog(null, "Introduce dos apellidos separados por espacio.");
				return;
			}

			if (usuario.isEmpty()) {
				JOptionPane.showMessageDialog(null, "El usuario no puede estar vacío.");
				return;
			}

			if (password.length == 0) {
				JOptionPane.showMessageDialog(null, "La contraseña no puede estar vacía.");
				return;
			}

			if (!telefono.matches("\\d+")) {
				JOptionPane.showMessageDialog(null, "El teléfono solo debe contener números.");
				return;
			}

			if (destino.equals("Elija su destino")) {
				JOptionPane.showMessageDialog(null, "Debe elegir un destino válido.");
				return;
			}

			if (vacunasSeleccionadas < 3) {
				JOptionPane.showMessageDialog(null, "Debe seleccionar al menos 3 vacunas.");
				return;
			}

			// Crear y guardar el usuario
			Usuario nuevoUsuario = new Usuario(
					nombre,
					apellidos,
					(Genero) generoBox.getSelectedItem(),
					usuario,
					telefono,
					destino,
					vacunasList.toArray(new String[0])
			);

			usuarios.add(nuevoUsuario);

			JOptionPane.showMessageDialog(null, nuevoUsuario.toString(), "Resumen", JOptionPane.INFORMATION_MESSAGE);
		}
	}
}
